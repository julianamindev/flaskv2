{% extends "base/base.html" %}

{% block body_class %}class="sb-nav-fixed"{% endblock %}

{% block nav %}
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <!-- Navbar Brand-->
        <a class="navbar-brand ps-3" href="{{ url_for('main.home') }}">DevOps Cockpit</a>

        <!-- Sidebar Toggle-->
        <button class="btn btn-link btn-sm me-4" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>

        <!-- Navbar-->
        <ul class="navbar-nav ms-auto me-3 me-lg-4">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                    <li><a class="dropdown-item" href="{{ url_for('users.register') }}">Settings</a></li>
                    <li><hr class="dropdown-divider" /></li>
                    <li><a class="dropdown-item" href="{{ url_for('users.logout') }}">Logout</a></li>
                </ul>
            </li>
        </ul>
    </nav>
{% endblock %} 

{% block content %}
    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <div class="sb-sidenav-menu-heading">Core</div>
                        <a class="nav-link" href="{{ url_for('main.home') }}">
                            <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                            Dashboard
                        </a>

                        {# Sections -> Subsections (collapsible) -> Links #}
                        {% for section, subsections in side_nav.items() %}
                            <div class="sb-sidenav-menu-heading">{{ section }}</div>

                            {# Give this section its own accordion container #}
                            {% set accordion_id = 'sidenavAcc-' ~ loop.index %}

                            {% for sub_name, details in subsections.items() %}
                                <a class="nav-link {% if not details.is_expanded %}collapsed{% endif %}"
                                href="#"
                                data-bs-toggle="collapse"
                                data-bs-target="#{{ details.ref }}"
                                aria-expanded="{{ 'true' if details.is_expanded else 'false' }}"
                                aria-controls="{{ details.ref }}">
                                    <div class="sb-nav-link-icon"><i class="{{ details.icon }}"></i></div>
                                    {{ sub_name }}
                                    <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                                </a>

                                <div class="collapse {% if details.is_expanded %}show{% endif %}"
                                    id="{{ details.ref }}"
                                    data-bs-parent="#{{ accordion_id }}">
                                    <nav class="sb-sidenav-menu-nested nav">
                                        {% for link in details.child_links %}
                                            <a class="nav-link {% if link.is_active %}active{% endif %}"
                                            href="{{ url_for(link.route) }}">{{ link.text }}</a>
                                        {% endfor %}
                                    </nav>
                                </div>
                            {% endfor %}
                        {% endfor %}                  

                        <!-- <div class="sb-sidenav-menu-heading">Utilities</div>
                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseAWS" aria-expanded="false" aria-controls="collapseAWS">
                            <div class="sb-nav-link-icon"><i class="fas fa-cloud"></i></div>
                            AWS
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseAWS" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{{ url_for('main.lars2aws') }}">LARS-to-AWS</a>
                                <a class="nav-link" href="#">Another utility</a>
                            </nav>
                        </div>
                        
                        {% if current_user.is_admin %}

                        <div class="sb-sidenav-menu-heading">Admin</div>
                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseUserMgmt" aria-expanded="false" aria-controls="collapseUserMgmt">
                            <div class="sb-nav-link-icon"><i class="fas fa-user"></i></div>
                            User Management
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseUserMgmt" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{{ url_for('main.user_list') }}">Users List</a>
                                <a class="nav-link" href="{{ url_for('users.register') }}">Register</a>
                            </nav>
                        </div>

                        {% endif %} -->
                        <!-- <a class="nav-link" href="tables.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                            Tables
                        </a> -->
                    </div>
                </div>
                <div class="sb-sidenav-footer">
                    <div class="small">Logged in as:</div>
                    {{ current_user.username }}
                </div>
            </nav>
        </div>
        <div id="layoutSidenav_content">

            {% block main %}{% endblock %}

        </div>
    </div>
{% endblock%}